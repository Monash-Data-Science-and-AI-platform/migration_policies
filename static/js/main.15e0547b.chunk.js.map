{"version":3,"sources":["../external \"Cesium\"","StoryPanel.js","Helper.js","CesiumViewer.js","Mediator.js","index.js"],"names":["module","exports","Cesium","StoryPanel","m_actionFilter","state","visible","id","props","paragraphs","res","i","this","length","push","content","text","actionFilter","setState","className","activeID","period","chapter","map","paragraph","key","panToFilter","highlightFilter","animation","yearStart","minYear","yearEnd","maxYear","updatePeriod","app","height","Component","StoryParagraph","m_firedAction","m_statusChanged","m_filterArray","handleScroll","event","topOffset","ReactDOM","findDOMNode","getBoundingClientRect","top","bottomOffset","bottom","highlighted","stopAnimation","doChapterAnimation","objects","highlightObjects","setActiveID","updateYears","panToCountry","country","paragraphChange","isIntersecting","window","removeEventListener","addEventListener","onChange","ReactHtmlParser","countries","getLocation","CesiumViewer","entities","action","name","console","log","getPropertyComparator","propers","type","admin","continent","subregion","getColor","HIGHLIGHT_WITH_POLICY","Color","ORANGE","withAlpha","HIGHLIGHT_NO_POLICY","ACTIVE_POLICY_ESTABLISHED_IN_PERIOD","AQUA","ACTIVE_HISTORICAL_POLICY","ANIMATION_HIGHLIGHT_COLOR","YELLOW","NOPOLICY","TRANSPARENT","migrationpolicies","undefined","animationHighlightCountry","highlightCountries","hasActivePolicyInPeriod","policies","startPolicy","endPolicy","parseInt","substr","start","end","getPolicyText","infoBoxContent","element","viewerRef","React","createRef","sceneRef","fetch","process","then","response","json","initialize","features","feature","coords","geometry","coordinates","properties","flatcoords","flat","PolygonHierarchy","Cartesian3","fromDegreesArray","j","style","ref","e","viewer","timeline","homeButton","fullscreenButton","vrButton","baseLayerPicker","pointOfView","destination","fromDegrees","cesiumElement","scene","camera","positionCartographic","duration","speed","onComplete","flightComplete","entity","resizeInfoBox","hierarchy","fill","show","material","outline","PureComponent","Mediator","updateDimensions","width","innerWidth","innerHeight","panelHeight","sections","activeId","componentDidMount","sectiondata","renderparagraphs","createPanelContent","year","allPanels","helper","lat","lon","animationIndex","sleep","ms","Promise","resolve","setTimeout","doAnimation","result","animate","replace","url","actions","k","highlight","keywords","panTo","min","max","lower","c","toUpperCase","section","title","NavMenuItem","selector","alignToTop","Legend","backgroundColor","Ion","defaultAccessToken","render","document","getElementById"],"mappings":"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","file":"static/js/main.15e0547b.chunk.js","sourcesContent":["module.exports = Cesium;","import React, { Component } from 'react';\r\nimport ReactDOM from 'react-dom'\r\nimport Observer from '@researchgate/react-intersection-observer';\r\nimport ReactHtmlParser from 'react-html-parser';\r\n\r\nexport default class StoryPanel extends Component {\r\n  //a storypanel is visible whenit enters the viewport until another enters.\r\n  m_actionFilter = null\r\n  state = {\r\n    visible: true,\r\n    id: this.props.id,\r\n    paragraphs: []\r\n  };\r\n\r\n\r\n\r\n\r\n  componentDidMount() {\r\n    var res = [];\r\n    for (var i = 0; i < this.props.paragraphs.length; i++) {\r\n      res.push(\r\n        { \"text\": this.props.paragraphs[i].props.content.text, \"filter\": this.props.paragraphs[i].props.actionFilter }\r\n      )\r\n\r\n\r\n\r\n      this.setState({\r\n        paragraphs: res\r\n      })\r\n    }\r\n  }\r\n\r\n  render() {\r\n\r\n    return (\r\n      <section id={\"section_\" + this.state.id} className={`storyPanelSection ${this.state.visible && this.state.id === this.props.activeID ? 'activePanel' : 'inactivePanel'}`} >\r\n    \r\n\r\n         {this.props.period[0]!==0 ?\r\n          <div id={\"chap_\" + this.props.chapter} className={`sticky sectiontitle`}> {this.props.period[0]} - { this.props.period[1]}</div>\r\n\r\n         :\"\"}\r\n\r\n        <div className=\"panelcontent\">\r\n          {this.props.paragraphs.map(\r\n            (paragraph, i) =>\r\n\r\n              <StoryParagraph\r\n                key={\"chap_\" + this.props.chapter + \"_id_p\" + i}\r\n                //id={\"chap_\" + this.props.chapter + \"_id_p\" + i}\r\n                paragraph={paragraph.props.content.text}\r\n                panToFilter={paragraph.props.panToFilter}\r\n                highlightFilter={paragraph.props.highlightFilter}\r\n                animation = {paragraph.props.animation}\r\n                yearStart={paragraph.props.content.minYear}\r\n                yearEnd={paragraph.props.content.maxYear}\r\n                updatePeriod = { this.props.period[0]===0}\r\n                app={this.props.app}\r\n                id = {this.props.id}\r\n                height={this.props.height}\r\n\r\n              />\r\n\r\n          )}\r\n        </div>\r\n\r\n      </section>\r\n\r\n    )\r\n  }\r\n}\r\n\r\nclass StoryParagraph extends Component {\r\n\r\n\r\n  m_firedAction = false\r\n  m_statusChanged = false\r\n\r\n\r\n  m_filterArray = [\"any\", []]\r\n  state = {\r\n    id: this.props.id,\r\n    visible: false\r\n  }\r\n\r\n\r\n  componentWillUnmount() {\r\n    window.removeEventListener('scroll', this.handleScroll);\r\n  };\r\n\r\n\r\n  handleScroll = (event) => {\r\n    //if the element is visible we check where it is on the screen, and highlight it when it enters a threshold, dehighlight when it exits.\r\n    if (this.state.visible) {\r\n      let topOffset = ReactDOM.findDOMNode(this).getBoundingClientRect().top\r\n      let bottomOffset = ReactDOM.findDOMNode(this).getBoundingClientRect().bottom\r\n     \r\n      //determine if the current paragraph should be highlighted. It should be highlighted if its beginning is visible on the main area of the page, OR, if the beginning is not visible, the bottom part of the paragraph\r\n      //is still the main object in the current view, which applies to long paragraphs.\r\n      //the border case of very very short paragraphs is prevented by adding an extra empty margin to the bottom of each paragraph, this could be a TODO to refine later if this is in any manner bad for the application.\r\n      if ((topOffset > 80 && topOffset < this.props.height*2/3 && bottomOffset > this.props.height/4) || (topOffset < 80 && bottomOffset > this.props.height/2) ) {\r\n        //if this paragraph has anactionFilter to it, apply it!\r\n        if (!this.state.highlighted) {\r\n          if(this.props.animation === true && !this.m_firedAction) {\r\n            this.props.app.doChapterAnimation(this.props.highlightFilter.objects)\r\n            this.m_firedAction = true\r\n          } else {\r\n            this.props.app.stopAnimation()\r\n          }\r\n         \r\n          this.setState({\r\n            highlighted: true\r\n          })\r\n          this.props.app.highlightObjects(this.props.highlightFilter.objects)\r\n          this.props.app.setActiveID(this.props.id)\r\n          //   console.log(this.props.yearStart)\r\n          this.props.app.updateYears(this.props.yearStart, this.props.yearEnd)\r\n          \r\n          if(this.props.panToFilter)\r\n            this.props.app.panToCountry(this.props.panToFilter.country)\r\n          \r\n        }\r\n\r\n\r\n      } else {\r\n\r\n        if (this.state.highlighted) {\r\n          //visible should update...\r\n          this.setState({\r\n            highlighted: false\r\n          })\r\n          //deactivate filter if thereisonw\r\n          this.m_firedAction = false\r\n        }\r\n\r\n      }\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    window.addEventListener('scroll', this.handleScroll);\r\n\r\n    //construct the filter if there is one\r\n    /*if (this.props.actionFilter) {\r\n      this.m_filterArray = [\"any\"]\r\n      //create the filter syntax fromthe actionFilter provided\r\n      for (var i = 0; i < this.props.actionFilter.types.length; i++) {\r\n        this.m_filterArray.push([\"==\", [\"get\", \"type\"], this.props.actionFilter.types[i]])\r\n      }\r\n      \r\n     \r\n    }*/\r\n  }\r\n\r\n  //gets called when the element intersects with Observer\r\n  paragraphChange = event => {\r\n    this.setState({\r\n      visible: event.isIntersecting\r\n    })\r\n\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div>\r\n      {this.props.updatePeriod ? \r\n          <div className={`sticky sectiontitle`}> {this.props.yearStart} - { this.props.yearEnd}</div>\r\n      : \r\n      \"\"}\r\n        <Observer\r\n          onChange={this.paragraphChange}\r\n        >\r\n\r\n          <p\r\n            className={`scrolltext ${this.state.highlighted ? \"active\" : \"\"}`}\r\n            id={this.props.id}>\r\n            {ReactHtmlParser(this.props.paragraph)}\r\n\r\n          </p>\r\n        </Observer>\r\n        </div>\r\n   \r\n    )\r\n  }\r\n}","\r\n\r\nconst countries =  {\r\n    \"Israel\": { \"lat\": 31.0461, \"lon\": 34.8516 },\r\n    \"Europe\": { \"lat\": 54.5260, \"lon\": 15.2551 },\r\n    \"China-Japan\": { \"lat\": 35.8617, \"lon\": 114.1954 },\r\n    \"India\": { \"lat\": 20.5937, \"lon\": 78.9629 },\r\n    \"Eritrea\": { \"lat\": 15.1794, \"lon\": 39.7823 },\r\n    \"Mexico\": { \"lat\": 23.6345, \"lon\": -102.5528},\r\n    \"Germany\": { \"lat\": 51.1657, \"lon\": 10.4515},\r\n    \"France\": { \"lat\": 46.2276, \"lon\": 2.2137},\r\n    \"Italy\": { \"lat\": 41.8719, \"lon\":12.5674},\r\n    \"China\":{\"lat\": 35.8617, \"lon\": 114.1954},\r\n    \"Japan\":{\"lat\": 36.2048, \"lon\": 138.2529},\r\n    \"Philippines\":{\"lat\":12.8797 , \"lon\": 121.7740},\r\n     \"Nepal\" :{\"lat\":28.3949 , \"lon\":84.1240 },\r\n    \"Bangladesh\" :{\"lat\":23.6850 , \"lon\": 90.3563},\r\n    \"Pakistan\":{\"lat\":30.3753 , \"lon\":69.3451 },\r\n    \"Hungary\":{ \"lat\": 51.1657, \"lon\": 10.4515},\r\n     \"Czech Republic\":{ \"lat\": 51.1657, \"lon\": 10.4515}, \"Estonia\":{ \"lat\":56.8796, \"lon\": 24.6032}, \"Latvia\":{ \"lat\":56.8796, \"lon\": 24.6032},\r\n      \"Lithuania\":{ \"lat\":56.8796, \"lon\": 24.6032},\r\n       \"Poland\":{ \"lat\": 51.1657, \"lon\": 10.4515}, \r\n       \"Slovakia\":{\"lat\": 51.1657, \"lon\": 10.4515}, \"Slovenia\": {\"lat\": 51.1657, \"lon\": 10.4515}, \"Ireland\":{\"lat\": 53.1424, \"lon\": -7.6921},\r\n        \"Portugal\":{\"lat\": 39.3999, \"lon\": -8.2245},\r\n       \"Central African Republic\": {\"lat\":6.6111,\"lon\":20.9394},\r\n       \"Brazil\":{\"lat\":-15.6280,\"lon\":-52.7226},\r\n       \"Cuba\":{\"lat\":21.5218,\"lon\":- 77.7812},\r\n       \"Africa\":{\"lat\":6.6111,\"lon\":20.9394},\r\n       \"South America\":{\"lat\":-15.6280,\"lon\":-52.7226},\r\n        \"Central Asia\": {\"lat\": 41.3775, \"lon\": 64.5853}\r\n}\r\nexport function getCountryLocations(){\r\n    return  countries\r\n}\r\n\r\nexport function getLocation(country){\r\n    return countries[country]\r\n}","import React, { Fragment, PureComponent } from 'react';\r\nimport { Viewer, Entity, PolygonGraphics, EntityDescription, CameraFlyTo } from 'resium';\r\nimport { Cartesian3, PolygonHierarchy, Color } from 'cesium';\r\n\r\n//import countries from \"./data/countries_min.geojson\"\r\nexport default class CesiumViewer extends PureComponent {\r\n    constructor(props) {\r\n        super(props);\r\n        this.viewerRef = React.createRef();\r\n        this.sceneRef = React.createRef();\r\n    }\r\n\r\n\r\n    //admin: land\r\n    //continent\r\n    //subregion\r\n    state = {\r\n        entities: []\r\n    }\r\n\r\n    componentDidMount() {\r\n        //convert country data to cesium entities.\r\n\r\n        fetch(process.env.PUBLIC_URL + \"/mergedMigrations.json\").then((response) => response.json()).then(countries => this.initialize(countries));\r\n\r\n    }\r\n\r\n\r\n    initialize(countries) {\r\n\r\n        let entities = []\r\n        let i\r\n        for (i = 0; i < countries.features.length; i++) {\r\n            let feature = countries.features[i]\r\n            let coords = feature.geometry.coordinates\r\n            let name = feature.properties.admin\r\n            let geometry\r\n            console.log(name)\r\n            if (feature.geometry.type === \"Polygon\") {\r\n                let flatcoords = coords[0].flat()\r\n\r\n                geometry = new PolygonHierarchy(Cartesian3.fromDegreesArray(flatcoords))\r\n                if (feature.properties.migrationpolicies) {\r\n\r\n                    entities.push({ country: name, name: name, geometry: geometry, properties: feature.properties })\r\n\r\n                }\r\n                // geometry = PolygonGeometry.createGeometry(hierarchy)\r\n            } else {\r\n                geometry = []\r\n                let flatcoords\r\n                for (let j = 0; j < coords.length; j++) {\r\n\r\n                    flatcoords = coords[j][0].flat()\r\n                    geometry = new PolygonHierarchy(Cartesian3.fromDegreesArray(flatcoords))\r\n                    if (feature.properties.migrationpolicies) {\r\n\r\n                        entities.push({ country: name, name: name + j, geometry: geometry, properties: feature.properties })\r\n\r\n                    }\r\n                    //  entities.push({ country: name, name: name + j, geometry: geometry, properties: feature.properties, popupText: this.getPolicyText(feature.properties.migrationpolicies) })\r\n                }\r\n\r\n                // entities.push({ name: name, children: children })\r\n            }\r\n\r\n        }\r\n        this.setState({\r\n            entities: entities\r\n        })\r\n\r\n    }\r\n\r\n\r\n    render() {\r\n        return <div className=\"cesiumViewer\" style={{ height: this.props.height }}>\r\n\r\n            <Viewer\r\n                ref={e => { this.viewer = e }}\r\n                style={{ height: this.props.height - 100, }}\r\n                timeline={false}\r\n                homeButton={false}\r\n\r\n                fullscreenButton={false}\r\n                vrButton={false}\r\n                animation={false}\r\n                \r\n                baseLayerPicker={true}\r\n\r\n            >\r\n                {this.props.pointOfView ?\r\n                    <CameraFlyTo\r\n                        destination={Cartesian3.fromDegrees(this.props.pointOfView[1], this.props.pointOfView[0], this.viewer.cesiumElement.scene.camera.positionCartographic.height)}\r\n\r\n                        duration={this.props.speed}\r\n                        onComplete={() => this.props.flightComplete()}\r\n                    />\r\n                    :\r\n                    \"\"\r\n                }\r\n\r\n              \r\n                \r\n                {this.state.entities.map(\r\n                    (entity, i) =>\r\n\r\n                        <Entity\r\n                            key={i}\r\n                            name={entity.country}\r\n                        //onMouseEnter={ () => this.action( entity.country,  \"Mouse Enter\")}\r\n                        //onMouseLeave={ () => this.action(entity.country,\"Mouse Leave\")}\r\n                        //onMouseDown={() => this.action(entity.country, entity.popupText)}\r\n\r\n                        >\r\n\r\n\r\n                            <EntityDescription\r\n                                resizeInfoBox={true}\r\n                            >\r\n                                {this.hasActivePolicyInPeriod(entity.properties.migrationpolicies) ?\r\n                                    this.getPolicyText(entity.properties.migrationpolicies)\r\n                                    :\r\n                                    <Fragment> No policy in current period.</Fragment>\r\n                                }\r\n\r\n                            </EntityDescription>\r\n\r\n\r\n\r\n                            <PolygonGraphics\r\n\r\n                                hierarchy={entity.geometry}\r\n                                fill={true}\r\n                                show={true}\r\n                                material={this.getColor(entity.properties)}\r\n                                outline={true}\r\n                                height={0}\r\n\r\n\r\n                            />\r\n\r\n\r\n\r\n\r\n                        </Entity>\r\n                )}\r\n\r\n            </Viewer>\r\n        </div>\r\n    }\r\n\r\n    action = (name, action) => {\r\n        console.log(name)\r\n        console.log(action)\r\n\r\n    }\r\n    getPropertyComparator = (propers, type) => {\r\n        //console.log(propers)\r\n        switch (type) {\r\n            case \"country\":\r\n                return propers.admin\r\n            case \"continent\":\r\n                return propers.continent\r\n            case \"subregion\":\r\n                return propers.subregion\r\n\r\n        }\r\n\r\n    }\r\n\r\n\r\n    getColor = (propers) => {\r\n        const HIGHLIGHT_WITH_POLICY = Color.ORANGE.withAlpha(0.7)\r\n        const HIGHLIGHT_NO_POLICY = Color.ORANGE.withAlpha(0.4)\r\n        const ACTIVE_POLICY_ESTABLISHED_IN_PERIOD = Color.AQUA.withAlpha(0.7)\r\n        const ACTIVE_HISTORICAL_POLICY = Color.AQUA.withAlpha(0.4)\r\n\r\n        const ANIMATION_HIGHLIGHT_COLOR = Color.YELLOW.withAlpha(1)\r\n\r\n        const NOPOLICY = Color.TRANSPARENT\r\n        //    console.log(this.props.highlightCountries)\r\n        if (propers.migrationpolicies) {\r\n                 if (this.props.animationHighlightCountry.name !== undefined && this.props.animationHighlightCountry.name === this.getPropertyComparator(propers, this.props.animationHighlightCountry.type)) {  //animation\r\n                      return ANIMATION_HIGHLIGHT_COLOR\r\n                  }\r\n      \r\n            for (let i = 0; i < this.props.highlightCountries.length; i++) {\r\n                if (this.props.highlightCountries[i].name === this.getPropertyComparator(propers, this.props.highlightCountries[i].type)) {\r\n                    //is country in the list of highlighted countries?\r\n                    //      console.log(this.props.highlightCountries[i].name)\r\n                    if (this.hasActivePolicyInPeriod(propers.migrationpolicies)) { // has an active policy\r\n                        //      console.log(\"highlight with policy\")\r\n                        return HIGHLIGHT_WITH_POLICY\r\n                    } else {\r\n                        //    console.log(\"highlight with no policy\")\r\n                        return HIGHLIGHT_NO_POLICY\r\n                    }\r\n                }\r\n\r\n            }\r\n            let policies = propers.migrationpolicies\r\n            for (let i = 0; i < policies.length; i++) {\r\n                let startPolicy = policies[i][\"Year of establishment\"]\r\n                let endPolicy = policies[i][\"Year of disestablishment\"]\r\n            \r\n                if (startPolicy !== \"Nil\" && startPolicy !== undefined && endPolicy !== undefined) {\r\n\r\n                    if ((parseInt(startPolicy.substr(0, 4)) <= this.props.maxYear) && ((endPolicy === \"Nil\") || (parseInt(endPolicy.substr(0, 4)) >= this.props.minYear))) {\r\n                        //             console.log(\"has active Policy\")\r\n                        if (parseInt(startPolicy.substr(0, 4)) < this.props.minYear) {\r\n                            //      console.log(\"hhistorical policy\")\r\n                            return ACTIVE_HISTORICAL_POLICY  //active policy established before the period\r\n                        } else {\r\n                            //        console.log(\"established in period\")\r\n                            return ACTIVE_POLICY_ESTABLISHED_IN_PERIOD\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            //    console.log(\"no policy\")\r\n        }\r\n\r\n        return NOPOLICY\r\n    }\r\n\r\n    hasActivePolicyInPeriod = (policies) => {\r\n        //console.log(\"...\")\r\n        if (policies) {\r\n\r\n            for (let i = 0; i < policies.length; i++) {\r\n                let start = policies[i][\"Year of establishment\"]\r\n                let end = policies[i][\"Year of disestablishment\"]\r\n\r\n                if (start !== \"Nil\" && start !== undefined && end !== undefined) {\r\n\r\n                    if ((parseInt(start.substr(0, 4)) <= this.props.maxYear) && ((end === \"Nil\") || (parseInt(end.substr(0, 4)) > this.props.minYear))) {\r\n                        //             console.log(\"has active Policy\")\r\n                        return true\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return false\r\n    }\r\n    getPolicyText = (policies) => {\r\n          // console.log(policies)\r\n        if (policies) {\r\n            let infoBoxContent = []\r\n            for (let i = 0; i < policies.length; i++) {\r\n                let start = policies[i][\"Year of establishment\"]\r\n                let end = policies[i][\"Year of disestablishment\"]\r\n                if (start !== \"Nil\" && start !== undefined && end !== undefined) {\r\n                    if ((parseInt(start.substr(0, 4)) <= this.props.maxYear) && ((end === \"Nil\") || (parseInt(end.substr(0, 4)) > this.props.minYear))) {\r\n                    \r\n                    let element = <Fragment key={i}><h3>Institution Name:  </h3> {policies[i][\"Institution name\"]} <br /> <h4> {policies[i][\"Year of establishment\"]} -{policies[i][\"Year of disestablishment\"]}</h4> <h4>Institution Overview:  </h4>  {policies[i][\"Institution Overview\"]} </Fragment>\r\n                  //  console.log(element)\r\n                    infoBoxContent.push(element)\r\n\r\n                    }\r\n                }\r\n\r\n            }\r\n            //console.log(infoBoxContent)\r\n            return infoBoxContent\r\n        }\r\n        return <Fragment> No active Policy in this period. </Fragment>\r\n    }\r\n}\r\n\r\n\r\n","import React, { Component } from 'react';\r\nimport './css/index.css';\r\nimport StoryPanel from './StoryPanel.js'\r\nimport sectiondata from './data/sections.json'\r\nimport ScrollIntoView from 'react-scroll-into-view'\r\nimport * as helper from './Helper.js'\r\nimport CesiumViewer from './CesiumViewer.js'\r\nimport { Cartesian3 } from 'cesium'\r\n\r\nexport default class Mediator extends Component {\r\n    updateDimensions = () => {\r\n        this.setState({ width: window.innerWidth, height: window.innerHeight, panelHeight: window.innerHeight - 100 });\r\n\r\n    };\r\n\r\n\r\n    state = {\r\n        sections: [],\r\n        width: 0,\r\n        height: 0,\r\n        //the years should be read from a file with their corresponding html content\r\n        // sorteddata: [],\r\n        activeId: 0,\r\n        panelHeight: 800,\r\n        minYear: 1945,\r\n        maxYear: 2020,\r\n        pointOfView: null,\r\n        highlightCountries: [],\r\n        animationHighlightCountry: \"\"\r\n\r\n    }\r\n \r\n    // m_mapFunctions = null\r\n    //\"Facility Name\", \"Status\", \"Region\", \"Technology\", \"Generator Capacity (MW)\", \"Latitude\", \"Longitude\"\r\n\r\n\r\n    componentDidMount = function () {\r\n        window.addEventListener('resize', this.updateDimensions);\r\n        this.updateDimensions()\r\n        let i\r\n        for (i = 0; i < sectiondata.sections.length; i++) {\r\n            sectiondata.sections[i].renderparagraphs = this.createPanelContent(sectiondata.sections[i].year, sectiondata.sections[i].paragraphs)\r\n\r\n        }\r\n        //   console.log(sectiondata.sections[4].renderparagraphs)\r\n        //read the content from file.\r\n        this.setState({\r\n            sections: sectiondata.sections\r\n        })\r\n\r\n\r\n\r\n        //  console.log(sectiondata.sections)\r\n\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        window.removeEventListener('resize', this.updateDimensions);\r\n    }\r\n    allPanels = []\r\n    setActiveID = (id) => {\r\n\r\n        this.setState({\r\n            activeId: id\r\n        })\r\n    }\r\n\r\n\r\n    createPanelContent(year, paragraphs) {\r\n\r\n        //read the text from somewhere based on the given year\r\n        let result = [];\r\n\r\n        let key = \"\"\r\n        for (let i = 0; i < paragraphs.length; i++) {\r\n            key = year + \"_\" + i\r\n            let highlightFilter = {\r\n                \"objects\": []\r\n            }\r\n            let panToFilter = \"\";\r\n            let animate = false\r\n            //check for features like links, if its a link, replace the \"text\" with a hyperlinnk to the \"url\"\r\n            if (paragraphs[i].features) {\r\n                for (let j = 0; j < paragraphs[i].features.length; j++) {\r\n                    let feature = paragraphs[i].features[j]\r\n                    if (feature.type === \"link\") {\r\n                        paragraphs[i].text = paragraphs[i].text.replace(feature.text, '<a href=\"' + feature.url + '\" target=\"_blank\">' + feature.text + '</a>')\r\n                        //                console.log(paragraphs[i].text)\r\n                    }\r\n                }\r\n            }\r\n            //if actions aredefined, they are added to the element here.\r\n            if (paragraphs[i].actions) {\r\n                for (let j = 0; j < paragraphs[i].actions.length; j++) {\r\n                    let action = paragraphs[i].actions[j]\r\n                    if (action[\"highlight\"] !== undefined) {\r\n\r\n\r\n                        //highlight means highlight the words in the text with a class of the same name, and filter things on the map of this name\r\n                        for (let k = 0; k < action.highlight.keywords.length; k++) {\r\n                            //     console.log(action.highlight.keywords[k])\r\n                            paragraphs[i].text = paragraphs[i].text.replace(action.highlight.keywords[k].name, \"<span class='bold'>\" + action.highlight.keywords[k].name + \"</span>\")\r\n                            highlightFilter.objects.push(action.highlight.keywords[k])\r\n\r\n                            //capitalise first letter otherwise the filter breaks \r\n                        }\r\n                    }\r\n                    if (action[\"panTo\"] !== undefined) {\r\n                        panToFilter = {\r\n                            \"country\": action.panTo\r\n                        }\r\n                    }\r\n\r\n                    if (action[\"animation\"] !== undefined) {\r\n                        animate = true\r\n                    }\r\n                }\r\n\r\n            }\r\n            result.push(\r\n                <div content={paragraphs[i]} id={key} animation={animate} panToFilter={panToFilter} highlightFilter={highlightFilter} />\r\n            )\r\n        }\r\n        return result\r\n    }\r\n\r\n\r\n    panToCountry = (country) => {\r\n        if (country !== undefined && country !== null) {\r\n            console.log(\"should pan to country: \" + country)\r\n\r\n            this.setState({\r\n                pointOfView: [helper.getLocation(country).lat, helper.getLocation(country).lon],\r\n\r\n                animation: false\r\n            })\r\n        } else {\r\n            this.setState({\r\n                pointOfView: null,\r\n\r\n\r\n            })\r\n        }\r\n    }\r\n\r\n    animationIndex = 0\r\n    highlightCountries = []\r\n    highlightObjects(objects) {\r\n        //highlight countries on the globe\r\n        this.setState({\r\n            highlightCountries: objects\r\n        })\r\n    }\r\n\r\n    doChapterAnimation(objects) {\r\n        console.log(\"chapterAnimation\")\r\n        this.highlightCountries = objects\r\n        this.doAnimation();\r\n    }\r\n\r\n    \r\n    sleep = ms => {\r\n        return new Promise(resolve => setTimeout(resolve, ms))\r\n    }\r\n \r\n    doAnimation = () =>{\r\n     \r\n\r\n          \r\n             if(this.animationIndex <   this.highlightCountries.length){\r\n                console.log( \"animate: \" +  this.highlightCountries[this.animationIndex].name)\r\n                this.setState({\r\n                    pointOfView: [helper.getLocation(  this.highlightCountries[this.animationIndex].name).lat, helper.getLocation(  this.highlightCountries[this.animationIndex].name).lon],\r\n                    speed: 0.4,\r\n                    animationHighlightCountry:   this.highlightCountries[this.animationIndex]\r\n                })\r\n            //    await this.sleep(2500)\r\n        \r\n            }else {\r\n                this.setState({\r\n                    pointOfView: \"\",\r\n                    speed:3 ,\r\n                    animationHighlightCountry: \"\"\r\n                })\r\n                this.animationIndex = 0\r\n                this.highlightCountries = []\r\n            }\r\n\r\n\r\n    }\r\n    flightComplete = () => {\r\n        console.log(\"Flight Complete\")\r\n        this.animationIndex++\r\n        this.doAnimation()\r\n    }\r\n    stopAnimation = () => {\r\n        this.setState({\r\n            animation: false\r\n        })\r\n    }\r\n    updateYears(min, max) {\r\n        console.log(\"update years: \" + min + \"   \" + max)\r\n        this.setState({\r\n            minYear: min,\r\n            maxYear: max\r\n        })\r\n    }\r\n    //capitalise the first letter of  string\r\n    cap(lower) {\r\n        return lower.replace(/^\\w/, c => c.toUpperCase());\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div className=\"MainContainer\">\r\n\r\n                <div className=\"navbar\" id=\"yearNav\">\r\n                    {this.state.sections.map(\r\n                        (section, i) =>\r\n                            <NavMenuItem\r\n                                key={i}\r\n                                id={i}\r\n                                chapter={section.chapter}\r\n                                name={section.title}\r\n                                activeId={this.state.activeId}\r\n                            />\r\n                    )}\r\n                </div>\r\n                <div className=\"Panels topDistance\" style={{ height: this.state.panelHeight }}>\r\n\r\n                    {this.state.sections.map(\r\n                        (section, i) =>\r\n\r\n                            <StoryPanel\r\n                                key={i}\r\n                                id={i}\r\n                                app={this}\r\n                                activeID={this.state.activeId} //the Storypanels figure out if they are the active panel and display accordingly\r\n                                title={section.title}\r\n                                chapter={section.chapter}\r\n                                paragraphs={section.renderparagraphs}\r\n                                period={section.period}\r\n                                height={this.state.height}\r\n                            />\r\n                    )}\r\n                </div>\r\n\r\n                <CesiumViewer\r\n                    height={this.state.height}\r\n                    minYear={this.state.minYear}\r\n                    maxYear={this.state.maxYear}\r\n                    highlightCountries={this.state.highlightCountries}\r\n                    pointOfView={this.state.pointOfView}\r\n                    animationHighlightCountry={this.state.animationHighlightCountry}\r\n                    flightComplete = {this.flightComplete}\r\n                />\r\n\r\n                <Legend />\r\n\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\n\r\n\r\nconst NavMenuItem = ({ id, name, chapter, activeId }) => (\r\n\r\n    <ScrollIntoView\r\n        selector={`#chap_${chapter}`}\r\n        alignToTop={false} >\r\n        <div className={`navItem ${id === activeId ? \"navItemActive\" : \"\"} `}> {name} </div>\r\n    </ScrollIntoView>\r\n)\r\n\r\n\r\n\r\nconst Legend = ({ }) => {\r\n    return <div className=\"legend\">\r\n        <div className=\"legendItem\">\r\n            <div className=\"legendLabel\">Highlight</div><div className=\"legendColor\" style={{ backgroundColor: \"orange\" }} />\r\n        </div>\r\n        <div className=\"legendItem\">\r\n            <div className=\"legendLabel\">Established during period</div><div className=\"legendColor\" style={{ backgroundColor: \"rgba(0,255,255,0.8)\" }} />\r\n        </div>\r\n        <div className=\"legendItem\">\r\n            <div className=\"legendLabel\">Established before period</div><div className=\"legendColor\" style={{ backgroundColor: \"rgba(0,255,255,0.4)\" }} />\r\n        </div>\r\n    </div>\r\n}","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport Mediator from './Mediator';\r\nimport {Ion}  from \"cesium\"\r\nIon.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIxNjdjMTU0Yi00MmQxLTRhM2MtYTFjZS02ZTgwZTViZDdkMjciLCJpZCI6MzczNzgsImlhdCI6MTYxMjc1MDgyMX0.Flj_3KxCUzLkIgFfnF1meU0Fw_WvYHsNPogyTGd6Jms';\r\n\r\n\r\n\r\nReactDOM.render(<Mediator />, document.getElementById('root'));\r\n"],"sourceRoot":""}